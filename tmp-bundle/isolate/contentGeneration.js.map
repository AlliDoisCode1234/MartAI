{
  "version": 3,
  "sources": ["../convex/contentGeneration.ts"],
  "sourcesContent": ["/**\r\n * Content Generation Actions\r\n *\r\n * One-click content generation using AI Router with quality guarantee.\r\n * Routes to best available AI provider with automatic failover.\r\n * Includes retry loop to ensure 90+ SEO score guarantee.\r\n */\r\n\r\nimport { action, internalMutation, internalAction } from './_generated/server';\r\nimport { v } from 'convex/values';\r\nimport { auth } from './auth';\r\nimport { internal, api } from './_generated/api';\r\nimport { Id } from './_generated/dataModel';\r\nimport type { ActionCtx } from './_generated/server';\r\nimport {\r\n  CONTENT_TYPES,\r\n  ContentTypeId,\r\n  DEFAULT_SEO_CHECKLIST,\r\n  contentTypeValidator,\r\n} from './phoo/contentTypes';\r\nimport { buildPersonaContext } from './ai/writerPersonas/index';\r\n\r\n// Quality threshold for A+ grade\r\nconst QUALITY_THRESHOLD = 90;\r\nconst MAX_GENERATION_ATTEMPTS = 3;\r\n\r\n// ============================================================================\r\n// Content Generation Action with Quality Guarantee\r\n// ============================================================================\r\n\r\nexport const generateContent = action({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n    contentType: contentTypeValidator,\r\n    title: v.string(),\r\n    keywords: v.array(v.string()),\r\n    clusterId: v.optional(v.id('keywordClusters')),\r\n  },\r\n  handler: async (ctx, args): Promise<Id<'contentPieces'>> => {\r\n    const userId = await auth.getUserId(ctx);\r\n    if (!userId) throw new Error('Unauthorized');\r\n\r\n    return await ctx.runAction(internal.contentGeneration.generateContentInternal, {\r\n      ...args,\r\n      userId,\r\n    });\r\n  },\r\n});\r\n\r\nexport const generateContentInternal = internalAction({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n    contentType: contentTypeValidator,\r\n    title: v.string(),\r\n    keywords: v.array(v.string()),\r\n    clusterId: v.optional(v.id('keywordClusters')),\r\n    userId: v.id('users'),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const { userId } = args;\r\n\r\n    // Get or create Writer Persona for this project\r\n    const persona = await ctx.runMutation(\r\n      internal.ai.writerPersonas.index.getOrCreatePersonaInternal,\r\n      {\r\n        projectId: args.projectId,\r\n        userId,\r\n      }\r\n    );\r\n\r\n    // Build persona context for prompt injection\r\n    const personaContext = persona ? buildPersonaContext(persona) : '';\r\n\r\n    // 1. Create content piece with \"generating\" status\r\n    const contentPieceId: Id<'contentPieces'> = await ctx.runMutation(\r\n      internal.contentGeneration.createContentPiece,\r\n      {\r\n        projectId: args.projectId,\r\n        contentType: args.contentType,\r\n        title: args.title,\r\n        keywords: args.keywords,\r\n        clusterId: args.clusterId,\r\n      }\r\n    );\r\n\r\n    // 2. Generate outline using AI (with persona context for industry/brand awareness)\r\n    const outline = await generateOutlineWithAI(\r\n      ctx,\r\n      args.contentType,\r\n      args.title,\r\n      args.keywords,\r\n      personaContext\r\n    );\r\n\r\n    // 3. Update with outline\r\n    await ctx.runMutation(internal.contentGeneration.updateContentPiece, {\r\n      contentPieceId,\r\n      h2Outline: outline,\r\n      status: 'generating',\r\n    });\r\n\r\n    // 4. Quality Guarantee Loop - retry until score >= 90 or max attempts\r\n    let attempt = 0;\r\n    let bestContent = '';\r\n    let bestScore = 0;\r\n    let bestMetrics: Record<string, number> = {};\r\n\r\n    while (attempt < MAX_GENERATION_ATTEMPTS) {\r\n      attempt++;\r\n      console.log(`[ContentGeneration] Attempt ${attempt}/${MAX_GENERATION_ATTEMPTS}`);\r\n\r\n      // Generate full content using AI Router (with persona context)\r\n      const content = await generateFullContentWithAI(\r\n        ctx,\r\n        args.contentType,\r\n        args.title,\r\n        outline,\r\n        args.keywords,\r\n        personaContext,\r\n        attempt > 1 // Add quality hints on retries\r\n      );\r\n\r\n      // Score content using content type's target word count\r\n      const contentTypeConfig = CONTENT_TYPES[args.contentType as ContentTypeId];\r\n      const targetWordCount = contentTypeConfig?.wordCount || 1200;\r\n      const { score, metrics } = scoreContent(content, outline, args.keywords, targetWordCount);\r\n      console.log(`[ContentGeneration] Score: ${score}`);\r\n\r\n      // Track best result\r\n      if (score > bestScore) {\r\n        bestContent = content;\r\n        bestScore = score;\r\n        bestMetrics = metrics;\r\n      }\r\n\r\n      // Quality threshold met - exit loop\r\n      if (score >= QUALITY_THRESHOLD) {\r\n        console.log(`[ContentGeneration] Quality threshold met (${score} >= ${QUALITY_THRESHOLD})`);\r\n        break;\r\n      }\r\n\r\n      // Log why we're retrying\r\n      if (attempt < MAX_GENERATION_ATTEMPTS) {\r\n        console.log(`[ContentGeneration] Retrying for better quality...`);\r\n        await ctx.runMutation(internal.contentGeneration.updateContentPiece, {\r\n          contentPieceId,\r\n          generationAttempts: attempt,\r\n        });\r\n      }\r\n    }\r\n\r\n    // 5. Update with best content\r\n    await ctx.runMutation(internal.contentGeneration.updateContentPiece, {\r\n      contentPieceId,\r\n      content: bestContent,\r\n      wordCount: countWords(bestContent),\r\n      seoScore: bestScore,\r\n      qualityMetrics: bestMetrics,\r\n      generationAttempts: attempt,\r\n      status: 'draft',\r\n    });\r\n\r\n    console.log(\r\n      `[ContentGeneration] Complete. Final score: ${bestScore} after ${attempt} attempt(s)`\r\n    );\r\n    return contentPieceId;\r\n  },\r\n});\r\n\r\n// ============================================================================\r\n// Internal Mutations\r\n// ============================================================================\r\n\r\nexport const createContentPiece = internalMutation({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n    contentType: v.union(\r\n      // Core Pages\r\n      v.literal('homepage'),\r\n      v.literal('about'),\r\n      v.literal('service'),\r\n      v.literal('landing'),\r\n      // Blog Content\r\n      v.literal('blog'),\r\n      v.literal('blogVersus'),\r\n      v.literal('blogVideo'),\r\n      v.literal('contentRefresh'),\r\n      // Conversion\r\n      v.literal('leadMagnet'),\r\n      v.literal('paidProduct'),\r\n      // Local/Geo\r\n      v.literal('areasWeServe'),\r\n      // Specialty\r\n      v.literal('employment'),\r\n      v.literal('mentorship'),\r\n      v.literal('donate'),\r\n      v.literal('events'),\r\n      v.literal('partner'),\r\n      v.literal('program')\r\n    ),\r\n    title: v.string(),\r\n    keywords: v.array(v.string()),\r\n    clusterId: v.optional(v.id('keywordClusters')),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const now = Date.now();\r\n    return await ctx.db.insert('contentPieces', {\r\n      projectId: args.projectId,\r\n      clusterId: args.clusterId,\r\n      contentType: args.contentType,\r\n      title: args.title,\r\n      h2Outline: [],\r\n      keywords: args.keywords,\r\n      status: 'generating',\r\n      generationAttempts: 0,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n    });\r\n  },\r\n});\r\n\r\nexport const updateContentPiece = internalMutation({\r\n  args: {\r\n    contentPieceId: v.id('contentPieces'),\r\n    h2Outline: v.optional(v.array(v.string())),\r\n    content: v.optional(v.string()),\r\n    wordCount: v.optional(v.number()),\r\n    seoScore: v.optional(v.number()),\r\n    qualityMetrics: v.optional(\r\n      v.object({\r\n        wordCountScore: v.number(),\r\n        h2Score: v.number(),\r\n        keywordScore: v.number(),\r\n        linkScore: v.number(),\r\n        readabilityScore: v.number(),\r\n        uniquenessScore: v.optional(v.number()),\r\n      })\r\n    ),\r\n    generationAttempts: v.optional(v.number()),\r\n    status: v.optional(\r\n      v.union(\r\n        v.literal('generating'),\r\n        v.literal('draft'),\r\n        v.literal('approved'),\r\n        v.literal('published'),\r\n        v.literal('scheduled')\r\n      )\r\n    ),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const { contentPieceId, ...updates } = args;\r\n    const filtered = Object.fromEntries(Object.entries(updates).filter(([, v]) => v !== undefined));\r\n    await ctx.db.patch(contentPieceId, {\r\n      ...filtered,\r\n      updatedAt: Date.now(),\r\n    });\r\n  },\r\n});\r\n\r\n// ============================================================================\r\n// AI-Powered Content Generation\r\n// ============================================================================\r\n\r\n/**\r\n * Generate outline using AI Router\r\n */\r\nasync function generateOutlineWithAI(\r\n  ctx: ActionCtx,\r\n  contentType: string,\r\n  title: string,\r\n  keywords: string[],\r\n  personaContext: string = ''\r\n): Promise<string[]> {\r\n  const primaryKeyword = keywords[0] || 'topic';\r\n  const targetSections = getTargetSections(contentType);\r\n\r\n  // Inject persona context if available (industry, brand voice, etc.)\r\n  const personaInstructions = personaContext\r\n    ? `\\n\\nCONTEXT FROM BRAND PERSONA:\\n${personaContext}\\n\\nApply the above brand context to your outline.`\r\n    : '';\r\n\r\n  const systemPrompt = `You are an expert SEO content strategist. Generate a content outline for a ${contentType} article.\r\n\r\nRequirements:\r\n- Create exactly ${targetSections} H2 sections\r\n- Include introduction and conclusion\r\n- Focus on the primary keyword: \"${primaryKeyword}\"\r\n- Optimize for search intent and user value\r\n- Each section should be actionable and specific\r\n${personaInstructions}\r\nRespond with ONLY the section titles, one per line. No numbering, no markdown, just the titles.`;\r\n\r\n  const prompt = `Create an SEO-optimized outline for: \"${title}\"\r\n\r\nKeywords to incorporate: ${keywords.join(', ')}\r\nContent type: ${contentType}`;\r\n\r\n  try {\r\n    const response = await ctx.runAction(api.ai.router.router.generateWithFallback, {\r\n      prompt,\r\n      systemPrompt,\r\n      maxTokens: 500,\r\n      temperature: 0.7,\r\n      taskType: 'analysis',\r\n      strategy: 'best_quality',\r\n    });\r\n\r\n    // Parse response into array of section titles\r\n    const sections = response.content\r\n      .split('\\n')\r\n      .map((s: string) => s.trim())\r\n      .filter((s: string) => s.length > 0 && !s.startsWith('#'));\r\n\r\n    return sections.length > 0 ? sections : getDefaultOutline(contentType, primaryKeyword);\r\n  } catch (error) {\r\n    console.warn('[ContentGeneration] AI outline failed, using template:', error);\r\n    return getDefaultOutline(contentType, primaryKeyword);\r\n  }\r\n}\r\n\r\n/**\r\n * Generate full content using AI Router\r\n */\r\nasync function generateFullContentWithAI(\r\n  ctx: ActionCtx,\r\n  contentType: string,\r\n  title: string,\r\n  outline: string[],\r\n  keywords: string[],\r\n  personaContext: string = '',\r\n  enhanceQuality: boolean = false\r\n): Promise<string> {\r\n  const primaryKeyword = keywords[0] || 'topic';\r\n  const targetWords = getTargetWords(contentType);\r\n  // Always aim higher than minimum to ensure we pass scoring\r\n  const wordCountTarget = targetWords + 300;\r\n\r\n  // ALWAYS include quality requirements (not just on retries)\r\n  const baseQualityRequirements = `\r\nQUALITY REQUIREMENTS (MANDATORY):\r\n- Write AT LEAST ${wordCountTarget} words - this is critical for SEO scoring\r\n- Use the primary keyword \"${primaryKeyword}\" naturally 10-15 times throughout\r\n- Use each secondary keyword at least 2-3 times\r\n- Include at least 1 H2 section for each outline item with 100+ words under each\r\n- Add specific examples, statistics, or actionable tips in each section\r\n- Write transition sentences between sections for flow`;\r\n\r\n  // Extra boost for retry attempts\r\n  const retryBoost = enhanceQuality\r\n    ? `\r\n\r\nRETRY BOOST (Previous attempt scored too low):\r\n- Increase word count to ${wordCountTarget + 200}+ words\r\n- Add more detailed examples and explanations\r\n- Expand each section with additional subpoints\r\n- Include FAQ section at the end if not present`\r\n    : '';\r\n\r\n  // Inject persona context for brand-aware content\r\n  const personaInstructions = personaContext\r\n    ? `\\n\\nBRAND PERSONA CONTEXT:\\n${personaContext}\\n\\nIMPORTANT: Write in the voice and style defined above. Use the vocabulary preferences and avoid the words listed.`\r\n    : '';\r\n\r\n  const systemPrompt = `You are an expert SEO content writer following E-E-A-T principles (Experience, Expertise, Authoritativeness, Trustworthiness).\r\n\r\nWriting guidelines:\r\n- Write in a professional but conversational tone\r\n- Target word count: ${wordCountTarget} words MINIMUM (aim for ${wordCountTarget + 100})\r\n- Use short paragraphs (2-4 sentences max)\r\n- Include actionable advice and specific examples\r\n- Add transition sentences between sections\r\n- Write for readability (aim for Flesch score 60+)\r\n${baseQualityRequirements}${retryBoost}${personaInstructions}\r\n\r\nFormat the content as Markdown with:\r\n- H1 title at the top\r\n- H2 headers for each section\r\n- Bold for key terms\r\n- Bullet lists where appropriate`;\r\n\r\n  const outlineText = outline.map((s, i) => `${i + 1}. ${s}`).join('\\n');\r\n\r\n  const prompt = `Write a complete ${contentType} article with this outline:\r\n\r\nTitle: ${title}\r\n\r\nOutline:\r\n${outlineText}\r\n\r\nKeywords: ${keywords.join(', ')}\r\n\r\nWrite the full article now, following the outline structure.`;\r\n\r\n  try {\r\n    const response = await ctx.runAction(api.ai.router.router.generateWithFallback, {\r\n      prompt,\r\n      systemPrompt,\r\n      maxTokens: 4000,\r\n      temperature: enhanceQuality ? 0.6 : 0.8, // Lower temp for quality retries\r\n      taskType: 'generation',\r\n      strategy: 'best_quality',\r\n    });\r\n\r\n    return response.content;\r\n  } catch (error) {\r\n    console.warn('[ContentGeneration] AI content failed, using fallback:', error);\r\n    return generateFallbackContent(title, outline, keywords);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// Fallback & Scoring Helpers\r\n// ============================================================================\r\n\r\nfunction getTargetSections(contentType: string): number {\r\n  const targets: Record<string, number> = {\r\n    blog: 8,\r\n    pillar: 10,\r\n    howto: 8,\r\n    comparison: 9,\r\n    listicle: 9,\r\n  };\r\n  return targets[contentType] || 8;\r\n}\r\n\r\nfunction getTargetWords(contentType: string): number {\r\n  // Use word counts from Content Intelligence (17 types)\r\n  const config = CONTENT_TYPES[contentType as ContentTypeId];\r\n  if (config) {\r\n    return config.wordCount;\r\n  }\r\n  // Fallback for legacy types\r\n  const legacyTargets: Record<string, number> = {\r\n    pillar: 3500,\r\n    howto: 1800,\r\n    comparison: 2000,\r\n    listicle: 1500,\r\n  };\r\n  return legacyTargets[contentType] || DEFAULT_SEO_CHECKLIST.wordCount;\r\n}\r\n\r\nfunction getDefaultOutline(contentType: string, primaryKeyword: string): string[] {\r\n  const templates: Record<string, string[]> = {\r\n    blog: [\r\n      'Introduction',\r\n      `What is ${primaryKeyword}?`,\r\n      `Why ${primaryKeyword} Matters`,\r\n      'Key Benefits',\r\n      'How to Get Started',\r\n      'Best Practices',\r\n      'Common Mistakes to Avoid',\r\n      'Conclusion',\r\n    ],\r\n    pillar: [\r\n      'Introduction',\r\n      `Complete Guide to ${primaryKeyword}`,\r\n      'Understanding the Fundamentals',\r\n      'Step-by-Step Process',\r\n      'Advanced Strategies',\r\n      'Tools and Resources',\r\n      'Case Studies',\r\n      'Expert Tips',\r\n      'Frequently Asked Questions',\r\n      'Conclusion and Next Steps',\r\n    ],\r\n    howto: [\r\n      'Introduction',\r\n      'What You Will Need',\r\n      'Step 1: Getting Started',\r\n      'Step 2: The Process',\r\n      'Step 3: Implementation',\r\n      'Step 4: Verification',\r\n      'Troubleshooting Common Issues',\r\n      'Conclusion',\r\n    ],\r\n    comparison: [\r\n      'Introduction',\r\n      'Quick Comparison Table',\r\n      'Option A: Overview',\r\n      'Option B: Overview',\r\n      'Feature-by-Feature Comparison',\r\n      'Pricing Comparison',\r\n      'Pros and Cons',\r\n      'Which One is Right for You?',\r\n      'Conclusion',\r\n    ],\r\n    listicle: [\r\n      'Introduction',\r\n      `Top ${primaryKeyword} Options`,\r\n      '1. First Item',\r\n      '2. Second Item',\r\n      '3. Third Item',\r\n      '4. Fourth Item',\r\n      '5. Fifth Item',\r\n      'Honorable Mentions',\r\n      'Conclusion',\r\n    ],\r\n  };\r\n\r\n  return templates[contentType] || templates.blog;\r\n}\r\n\r\nfunction generateFallbackContent(title: string, outline: string[], keywords: string[]): string {\r\n  const primaryKeyword = keywords[0] || 'topic';\r\n  let content = `# ${title}\\n\\n`;\r\n\r\n  for (const section of outline) {\r\n    content += `## ${section}\\n\\n`;\r\n    content += `When it comes to ${primaryKeyword}, understanding this section is essential for success. `;\r\n    content += `Many professionals overlook the importance of ${section.toLowerCase()}, but it can make a significant difference in your results.\\n\\n`;\r\n    content += `By focusing on key elements related to ${primaryKeyword}, you can achieve better outcomes. `;\r\n    content += `This section provides actionable insights that you can implement immediately.\\n\\n`;\r\n  }\r\n\r\n  return content;\r\n}\r\n\r\nfunction countWords(content: string): number {\r\n  return (content || '').split(/\\s+/).filter((word) => word.length > 0).length;\r\n}\r\n\r\nfunction scoreContent(\r\n  content: string,\r\n  outline: string[],\r\n  keywords: string[],\r\n  targetWordCount: number = 1200\r\n): { score: number; metrics: Record<string, number> } {\r\n  const safeContent = content || '';\r\n  const wordCount = countWords(safeContent);\r\n  const h2Count = (safeContent.match(/^## /gm) || []).length;\r\n  const primaryKeyword = keywords[0]?.toLowerCase() || '';\r\n  const keywordMentions = primaryKeyword\r\n    ? (safeContent.toLowerCase().match(new RegExp(primaryKeyword, 'g')) || []).length\r\n    : 0;\r\n\r\n  // Score components (0-100 each) - use dynamic word count target\r\n  const wordCountScore = Math.min(100, (wordCount / targetWordCount) * 100);\r\n  const h2Score = Math.min(100, (h2Count / 6) * 100); // Lower bar: 6 H2s for 100%\r\n  const keywordScore = Math.min(100, (keywordMentions / 8) * 100); // 8 mentions for 100%\r\n  const readabilityScore = 85; // Baseline for well-structured AI content\r\n\r\n  // Calculate coverage bonus: how much of outline is covered\r\n  const outlineCoverage = outline.reduce((count, section) => {\r\n    return count + (safeContent.toLowerCase().includes(section.toLowerCase().slice(0, 20)) ? 1 : 0);\r\n  }, 0);\r\n  const structureScore = Math.min(100, (outlineCoverage / Math.max(outline.length, 1)) * 100);\r\n\r\n  // Weighted average - removed link score penalty\r\n  // Word Count: 25%, Keywords: 25%, Structure: 20%, H2s: 15%, Readability: 15%\r\n  const score = Math.round(\r\n    wordCountScore * 0.25 +\r\n      keywordScore * 0.25 +\r\n      structureScore * 0.2 +\r\n      h2Score * 0.15 +\r\n      readabilityScore * 0.15\r\n  );\r\n\r\n  return {\r\n    score: Math.min(100, score),\r\n    metrics: {\r\n      wordCountScore: Math.round(wordCountScore),\r\n      h2Score: Math.round(h2Score),\r\n      keywordScore: Math.round(keywordScore),\r\n      structureScore: Math.round(structureScore),\r\n      readabilityScore: Math.round(readabilityScore),\r\n    },\r\n  };\r\n}\r\n"],
  "mappings": "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",
  "names": ["init_values", "init_api", "QUALITY_THRESHOLD", "MAX_GENERATION_ATTEMPTS", "generateContent", "action", "v", "contentTypeValidator", "__name", "ctx", "args", "userId", "auth", "internal", "generateContentInternal", "internalAction", "persona", "personaContext", "buildPersonaContext", "contentPieceId", "outline", "generateOutlineWithAI", "attempt", "bestContent", "bestScore", "bestMetrics", "content", "generateFullContentWithAI", "targetWordCount", "CONTENT_TYPES", "score", "metrics", "scoreContent", "countWords", "createContentPiece", "internalMutation", "now", "updateContentPiece", "updates", "filtered", "contentType", "title", "keywords", "primaryKeyword", "targetSections", "getTargetSections", "personaInstructions", "systemPrompt", "prompt", "sections", "api", "s", "getDefaultOutline", "error", "enhanceQuality", "wordCountTarget", "getTargetWords", "baseQualityRequirements", "retryBoost", "outlineText", "i", "generateFallbackContent", "config", "DEFAULT_SEO_CHECKLIST", "templates", "section", "word", "safeContent", "wordCount", "h2Count", "keywordMentions", "wordCountScore", "h2Score", "keywordScore", "readabilityScore", "outlineCoverage", "count", "structureScore"]
}
