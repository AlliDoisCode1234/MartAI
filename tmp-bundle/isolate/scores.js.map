{
  "version": 3,
  "sources": ["../convex/scores.ts"],
  "sourcesContent": ["import { query } from './_generated/server';\r\nimport { v } from 'convex/values';\r\n\r\n/**\r\n * Scores Queries\r\n *\r\n * Provides SEO health scores and metrics for the Insights page.\r\n * Uses the phoo rating system under the hood.\r\n */\r\n\r\n/**\r\n * Get project SEO score and health metrics.\r\n * Returns visibility, traffic health, CTR performance, etc.\r\n */\r\nexport const getProjectScore = query({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    // Get project\r\n    const project = await ctx.db.get(args.projectId);\r\n    if (!project) {\r\n      return null;\r\n    }\r\n\r\n    // Count project data for score calculation\r\n    const keywords = await ctx.db\r\n      .query('keywords')\r\n      .filter((q) => q.eq(q.field('projectId'), args.projectId))\r\n      .collect();\r\n\r\n    const clusters = await ctx.db\r\n      .query('keywordClusters')\r\n      .filter((q) => q.eq(q.field('projectId'), args.projectId))\r\n      .collect();\r\n\r\n    const contentPieces = await ctx.db\r\n      .query('contentPieces')\r\n      .filter((q) => q.eq(q.field('projectId'), args.projectId))\r\n      .collect();\r\n\r\n    // Calculate score components based on project data\r\n    const keywordScore = Math.min(100, keywords.length * 2);\r\n    const clusterScore = Math.min(100, clusters.length * 10);\r\n    const contentScore = Math.min(100, contentPieces.length * 5);\r\n    const publishedCount = contentPieces.filter((c) => c.status === 'published').length;\r\n    const publishScore = Math.min(100, publishedCount * 10);\r\n\r\n    // Overall score weighted average\r\n    const overall = Math.round(\r\n      keywordScore * 0.25 + clusterScore * 0.25 + contentScore * 0.25 + publishScore * 0.25\r\n    );\r\n\r\n    // Determine tier\r\n    let tier: 'excellent' | 'good' | 'moderate' | 'needs_work';\r\n    if (overall >= 80) tier = 'excellent';\r\n    else if (overall >= 60) tier = 'good';\r\n    else if (overall >= 40) tier = 'moderate';\r\n    else tier = 'needs_work';\r\n\r\n    return {\r\n      projectId: args.projectId,\r\n      overall,\r\n      tier,\r\n      visibility: keywordScore,\r\n      trafficHealth: clusterScore,\r\n      ctrPerformance: contentScore,\r\n      quickWinPotential: Math.round((100 - overall) * 0.7),\r\n      lastCalculated: Date.now(),\r\n    };\r\n  },\r\n});\r\n"],
  "mappings": ";;;;;;;;;;;;AACAA;AAaO,IAAMC,IAAkBC,EAAM;AAAA,EACnC,MAAM;AAAA,IACJ,WAAWC,EAAE,GAAG,UAAU;AAAA,EAC5B;AAAA,EACA,SAAS,gBAAAC,EAAA,OAAOC,GAAKC,MAAS;AAG5B,QAAI,CADY,MAAMD,EAAI,GAAG,IAAIC,EAAK,SAAS;AAE7C,aAAO;AAIT,QAAMC,IAAW,MAAMF,EAAI,GACxB,MAAM,UAAU,EAChB,OAAO,CAACG,MAAMA,EAAE,GAAGA,EAAE,MAAM,WAAW,GAAGF,EAAK,SAAS,CAAC,EACxD,QAAQ,GAELG,IAAW,MAAMJ,EAAI,GACxB,MAAM,iBAAiB,EACvB,OAAO,CAACG,MAAMA,EAAE,GAAGA,EAAE,MAAM,WAAW,GAAGF,EAAK,SAAS,CAAC,EACxD,QAAQ,GAELI,IAAgB,MAAML,EAAI,GAC7B,MAAM,eAAe,EACrB,OAAO,CAACG,MAAMA,EAAE,GAAGA,EAAE,MAAM,WAAW,GAAGF,EAAK,SAAS,CAAC,EACxD,QAAQ,GAGLK,IAAe,KAAK,IAAI,KAAKJ,EAAS,SAAS,CAAC,GAChDK,IAAe,KAAK,IAAI,KAAKH,EAAS,SAAS,EAAE,GACjDI,IAAe,KAAK,IAAI,KAAKH,EAAc,SAAS,CAAC,GACrDI,IAAiBJ,EAAc,OAAO,CAACK,MAAMA,EAAE,WAAW,WAAW,EAAE,QACvEC,IAAe,KAAK,IAAI,KAAKF,IAAiB,EAAE,GAGhDG,IAAU,KAAK;AAAA,MACnBN,IAAe,OAAOC,IAAe,OAAOC,IAAe,OAAOG,IAAe;AAAA,IACnF,GAGIE;AACJ,WAAID,KAAW,KAAIC,IAAO,cACjBD,KAAW,KAAIC,IAAO,SACtBD,KAAW,KAAIC,IAAO,aAC1BA,IAAO,cAEL;AAAA,MACL,WAAWZ,EAAK;AAAA,MAChB,SAAAW;AAAA,MACA,MAAAC;AAAA,MACA,YAAYP;AAAA,MACZ,eAAeC;AAAA,MACf,gBAAgBC;AAAA,MAChB,mBAAmB,KAAK,OAAO,MAAMI,KAAW,GAAG;AAAA,MACnD,gBAAgB,KAAK,IAAI;AAAA,IAC3B;AAAA,EACF,GApDS;AAqDX,CAAC;",
  "names": ["init_values", "getProjectScore", "query", "v", "__name", "ctx", "args", "keywords", "q", "clusters", "contentPieces", "keywordScore", "clusterScore", "contentScore", "publishedCount", "c", "publishScore", "overall", "tier"]
}
