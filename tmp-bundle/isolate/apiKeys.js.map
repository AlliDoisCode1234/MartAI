{
  "version": 3,
  "sources": ["../convex/apiKeys.ts"],
  "sourcesContent": ["import { v } from 'convex/values';\r\nimport { mutation, query, internalQuery } from './_generated/server';\r\nimport { Id } from './_generated/dataModel';\r\n\r\n/**\r\n * API Keys Module\r\n * \u251C\u2500\u2500 convex/\r\n * \u2502   \u2514\u2500\u2500 apiKeys.ts (this file)\r\n *\r\n * Manages API keys for public API access (Enterprise feature)\r\n */\r\n\r\n// Generate a random API key with mart_ prefix (32 random chars)\r\nfunction generateApiKey(): string {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n  let key = 'mart_';\r\n  for (let i = 0; i < 32; i++) {\r\n    key += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * Hash an API key for secure storage\r\n * Uses multiple passes of djb2-like hashing to produce a 64-char hex string\r\n */\r\nfunction hashKey(key: string): string {\r\n  // Helper: simple 32-bit hash\r\n  const hash32 = (str: string, seed: number): number => {\r\n    let h = seed;\r\n    for (let i = 0; i < str.length; i++) {\r\n      h = ((h << 5) - h + str.charCodeAt(i)) | 0;\r\n    }\r\n    return Math.abs(h);\r\n  };\r\n\r\n  // Generate 8 hash values for 64 chars total\r\n  const h1 = hash32(key, 5381).toString(16).padStart(8, '0');\r\n  const h2 = hash32(key, 33).toString(16).padStart(8, '0');\r\n  const h3 = hash32(key.split('').reverse().join(''), 5381).toString(16).padStart(8, '0');\r\n  const h4 = hash32(key.split('').reverse().join(''), 33).toString(16).padStart(8, '0');\r\n  const h5 = hash32(key + key, 7919)\r\n    .toString(16)\r\n    .padStart(8, '0');\r\n  const h6 = hash32(key, 65599).toString(16).padStart(8, '0');\r\n  const h7 = hash32(key.slice(0, Math.floor(key.length / 2)), 5381)\r\n    .toString(16)\r\n    .padStart(8, '0');\r\n  const h8 = hash32(key.slice(Math.floor(key.length / 2)), 5381)\r\n    .toString(16)\r\n    .padStart(8, '0');\r\n\r\n  return h1 + h2 + h3 + h4 + h5 + h6 + h7 + h8;\r\n}\r\n\r\ntype Permission = 'read' | 'write' | 'admin';\r\n\r\n// Create a new API key\r\nexport const createApiKey = mutation({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n    name: v.string(),\r\n    description: v.optional(v.string()),\r\n    permissions: v.array(v.union(v.literal('read'), v.literal('write'), v.literal('admin'))),\r\n    expiresInDays: v.optional(v.number()),\r\n  },\r\n  handler: async (ctx, args): Promise<{ keyId: Id<'apiKeys'>; apiKey: string }> => {\r\n    const identity = await ctx.auth.getUserIdentity();\r\n    if (!identity) {\r\n      throw new Error('Unauthorized');\r\n    }\r\n\r\n    // Get user from identity\r\n    const user = await ctx.db\r\n      .query('users')\r\n      .withIndex('email', (q) => q.eq('email', identity.email))\r\n      .first();\r\n\r\n    if (!user) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    // Verify user has access to this project\r\n    const project = await ctx.db.get(args.projectId);\r\n    if (!project || project.userId !== user._id) {\r\n      throw new Error('Access denied to project');\r\n    }\r\n\r\n    // Check subscription tier (Enterprise only)\r\n    const subscription = await ctx.db\r\n      .query('subscriptions')\r\n      .withIndex('by_user', (q) => q.eq('userId', user._id))\r\n      .first();\r\n\r\n    if (!subscription || !['enterprise', 'team'].includes(subscription.planTier)) {\r\n      throw new Error('API keys require Team or Enterprise plan');\r\n    }\r\n\r\n    // Generate the API key\r\n    const apiKey = generateApiKey();\r\n    const keyHash = hashKey(apiKey);\r\n    const keyPrefix = apiKey.substring(0, 12); // mart_xxxx\r\n\r\n    const now = Date.now();\r\n    const expiresAt = args.expiresInDays\r\n      ? now + args.expiresInDays * 24 * 60 * 60 * 1000\r\n      : undefined;\r\n\r\n    const keyId = await ctx.db.insert('apiKeys', {\r\n      userId: user._id,\r\n      projectId: args.projectId,\r\n      keyHash,\r\n      keyPrefix,\r\n      name: args.name,\r\n      description: args.description,\r\n      permissions: args.permissions as Permission[],\r\n      isActive: true,\r\n      usageCount: 0,\r\n      expiresAt,\r\n      createdAt: now,\r\n    });\r\n\r\n    // Return the full key only once (user must save it)\r\n    return { keyId, apiKey };\r\n  },\r\n});\r\n\r\n// List API keys for a project (doesn't return full keys or keyHash)\r\n// Security: NEVER return keyHash - that's the authentication secret\r\nexport const listApiKeys = query({\r\n  args: {\r\n    projectId: v.id('projects'),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const identity = await ctx.auth.getUserIdentity();\r\n    if (!identity) {\r\n      throw new Error('Unauthorized');\r\n    }\r\n\r\n    const user = await ctx.db\r\n      .query('users')\r\n      .withIndex('email', (q) => q.eq('email', identity.email))\r\n      .first();\r\n\r\n    if (!user) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    const apiKeys = await ctx.db\r\n      .query('apiKeys')\r\n      .withIndex('by_project', (q) => q.eq('projectId', args.projectId))\r\n      .filter((q) => q.eq(q.field('userId'), user._id))\r\n      .collect();\r\n\r\n    // Security: Filter to safe fields only - NEVER return keyHash\r\n    return apiKeys.map((key) => ({\r\n      _id: key._id,\r\n      _creationTime: key._creationTime,\r\n      userId: key.userId,\r\n      projectId: key.projectId,\r\n      keyPrefix: key.keyPrefix, // Safe: just first 12 chars like \"mart_xxxx\"\r\n      name: key.name,\r\n      description: key.description,\r\n      permissions: key.permissions,\r\n      isActive: key.isActive,\r\n      usageCount: key.usageCount,\r\n      lastUsedAt: key.lastUsedAt,\r\n      expiresAt: key.expiresAt,\r\n      createdAt: key.createdAt,\r\n      revokedAt: key.revokedAt,\r\n      // keyHash is INTENTIONALLY EXCLUDED - it's the auth secret\r\n    }));\r\n  },\r\n});\r\n\r\n// Revoke an API key\r\nexport const revokeApiKey = mutation({\r\n  args: {\r\n    keyId: v.id('apiKeys'),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const identity = await ctx.auth.getUserIdentity();\r\n    if (!identity) {\r\n      throw new Error('Unauthorized');\r\n    }\r\n\r\n    const user = await ctx.db\r\n      .query('users')\r\n      .withIndex('email', (q) => q.eq('email', identity.email))\r\n      .first();\r\n\r\n    if (!user) {\r\n      throw new Error('User not found');\r\n    }\r\n\r\n    const apiKey = await ctx.db.get(args.keyId);\r\n    if (!apiKey || apiKey.userId !== user._id) {\r\n      throw new Error('API key not found');\r\n    }\r\n\r\n    await ctx.db.patch(args.keyId, {\r\n      isActive: false,\r\n      revokedAt: Date.now(),\r\n    });\r\n\r\n    return { success: true };\r\n  },\r\n});\r\n\r\n// Public: Validate API key (called from Next.js API routes via HTTP client)\r\n// Note: No auth required - the API key itself is the authentication\r\nexport const validateApiKey = query({\r\n  args: {\r\n    keyHash: v.string(),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const apiKey = await ctx.db\r\n      .query('apiKeys')\r\n      .withIndex('by_key_hash', (q) => q.eq('keyHash', args.keyHash))\r\n      .first();\r\n\r\n    if (!apiKey) {\r\n      return null;\r\n    }\r\n\r\n    // Check if active\r\n    if (!apiKey.isActive) {\r\n      return null;\r\n    }\r\n\r\n    // Check expiration\r\n    if (apiKey.expiresAt && apiKey.expiresAt < Date.now()) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      keyId: apiKey._id,\r\n      userId: apiKey.userId,\r\n      projectId: apiKey.projectId,\r\n      permissions: apiKey.permissions,\r\n    };\r\n  },\r\n});\r\n\r\n// Internal: Record API key usage\r\nexport const recordApiKeyUsage = mutation({\r\n  args: {\r\n    keyId: v.id('apiKeys'),\r\n  },\r\n  handler: async (ctx, args) => {\r\n    const apiKey = await ctx.db.get(args.keyId);\r\n    if (!apiKey) return;\r\n\r\n    await ctx.db.patch(args.keyId, {\r\n      lastUsedAt: Date.now(),\r\n      usageCount: apiKey.usageCount + 1,\r\n    });\r\n  },\r\n});\r\n\r\n/**\r\n * Check and consume API rate limit\r\n * Returns rate limit status and headers to include in response\r\n *\r\n * Note: This uses a simple in-memory approximation for now.\r\n * For production, integrate with @convex-dev/rate-limiter properly.\r\n */\r\nexport const checkApiRateLimit = mutation({\r\n  args: {\r\n    keyId: v.id('apiKeys'),\r\n    endpoint: v.string(), // e.g., 'keywords_read', 'keywords_write'\r\n  },\r\n  handler: async (\r\n    ctx,\r\n    args\r\n  ): Promise<{\r\n    allowed: boolean;\r\n    limit: number;\r\n    remaining: number;\r\n    resetAt: number;\r\n    retryAfter?: number;\r\n  }> => {\r\n    const apiKey = await ctx.db.get(args.keyId);\r\n    if (!apiKey) {\r\n      return { allowed: false, limit: 0, remaining: 0, resetAt: 0, retryAfter: 60 };\r\n    }\r\n\r\n    // Rate limits per minute by endpoint\r\n    const limits: Record<string, number> = {\r\n      keywords_read: 100,\r\n      keywords_write: 50,\r\n      clusters_read: 100,\r\n      briefs_read: 100,\r\n      analytics_read: 60,\r\n    };\r\n\r\n    const limit = limits[args.endpoint] || 100;\r\n    const windowMs = 60 * 1000; // 1 minute window\r\n    const now = Date.now();\r\n\r\n    // Get or create rate limit tracking\r\n    // We'll track this in the API key's lastUsedAt and usageCount\r\n    // For a proper implementation, we'd use a separate rate limit table\r\n    // For now, we'll do a simple check based on usageCount per minute\r\n\r\n    // Calculate window start\r\n    const windowStart = now - windowMs;\r\n\r\n    // Check if we're in a new window (last used was before window start)\r\n    const isNewWindow = !apiKey.lastUsedAt || apiKey.lastUsedAt < windowStart;\r\n\r\n    // Get current count in this window\r\n    // For simplicity, we'll reset usageCount if in new window\r\n    let currentCount = isNewWindow ? 0 : apiKey.usageCount;\r\n\r\n    // Calculate remaining\r\n    const remaining = Math.max(0, limit - currentCount - 1);\r\n    const allowed = currentCount < limit;\r\n\r\n    // Calculate reset time (end of current window)\r\n    const resetAt = Math.floor((now + windowMs) / 1000); // Unix timestamp in seconds\r\n\r\n    // Update tracking\r\n    if (allowed) {\r\n      await ctx.db.patch(args.keyId, {\r\n        lastUsedAt: now,\r\n        usageCount: isNewWindow ? 1 : currentCount + 1,\r\n      });\r\n    }\r\n\r\n    return {\r\n      allowed,\r\n      limit,\r\n      remaining: allowed ? remaining : 0,\r\n      resetAt,\r\n      retryAfter: allowed ? undefined : Math.ceil((resetAt * 1000 - now) / 1000),\r\n    };\r\n  },\r\n});\r\n"],
  "mappings": "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",
  "names": ["init_values", "generateApiKey", "chars", "key", "__name", "hashKey", "hash32", "str", "seed", "h", "i", "h1", "h2", "h3", "h4", "h5", "h6", "h7", "h8", "createApiKey", "mutation", "v", "ctx", "args", "identity", "user", "q", "project", "subscription", "apiKey", "keyHash", "keyPrefix", "now", "expiresAt", "listApiKeys", "query", "revokeApiKey", "validateApiKey", "recordApiKeyUsage", "checkApiRateLimit", "limit", "windowMs", "windowStart", "isNewWindow", "currentCount", "remaining", "allowed", "resetAt"]
}
